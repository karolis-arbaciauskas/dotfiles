#!/usr/bin/env bash
set -e

KEY_NAME="GitHub SSH Key"
VAULT="Private"

# Try to get existing item ID
ITEM_ID=$(op item get "$KEY_NAME" --vault "$VAULT" --format json 2>/dev/null | jq -r '.id' || echo "")

# Create key if it doesn't exist
if [ -z "$ITEM_ID" ]; then
  echo "ğŸ” Creating SSH key in 1Password..."
  ITEM_ID=$(op item create --category ssh --title "$KEY_NAME" --vault "$VAULT" --ssh-generate-key={{ .sshKeyType }} --format json | jq -r '.id')
  echo "âœ… SSH key created"
else
  echo "âœ… SSH key already exists in 1Password"
fi

# Print public key for GitHub setup
echo ""
echo "ğŸ‘‰ Add this public key to GitHub:"
op item get "$ITEM_ID" --fields label=public_key
